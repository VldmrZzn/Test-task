# Test-task

## **1.Предположим, ответы заказчика такие:**

**Технические характеристики:**
*   Насос центробежный, 3-фазный, управляется через пускатель (катушка 220В AC).
*   Есть датчик давления с аналоговым выходом 4-20 мА (давление 0-10 бар).
*   Частотного преобразователя нет.
*   Есть сигнал "Авария" от теплового реле насоса (нормально-замкнутый контакт, при перегрузке размыкается).

**Функциональность:**
*   **Критерий:** Поддержание давления в системе в диапазоне **P_min=3.5 бар - P_max=5.0 бар**.
*   **Режимы:** Ручной, Автоматический.
*   **Защиты:** Останов при аварии теплового реле, при падении давления ниже 2.0 бар (обрыв трубопровода) и при превышении выше 6.5 бар.

**Интерфейс:**
*   На панели HMI должны быть: Кнопки ВКЛ/ВЫКЛ, переключатель РЕЖИМ (Авто/Руч), индикаторы состояния и аварии, поле для уставок P_min/P_max.
*   Нужен счётчик моточасов.

**Аппаратная часть:**

**Дискретные входы (DI)**
di_0 – Кнопка "Пуск" (панель или кнопочный пост)

di_1 – Кнопка "Стоп"

di_3 – Сигнал "Авария" от теплового реле (НЗ контакт)

di_4 – Переключатель "Авто/Ручной"

**Дискретные выходы (DO):**

Do_0 – Пускатель насоса (или реле управления)

**Аналоговые входы (AI):**

Датчик давления 4-20 мА


**Примерный код программы на языке ST**

[Примерный код  реализации ФБ](proc.st)

## **2.Предложить реализацию функционала из задания 1 на HMI. (Фактическая реализация на какой-либо SCADA не обязательна, интересна идея и обоснование принятых решений):**

**Главный экран**

Элементы:
- Круг-насос: зелёный при работе, красный при аварии, серый в стопе
- Давление: цифра + цветная полоса (зелёная 3.5-5.0, жёлтые границы)
- Кнопки ПУСК/СТОП: активны только в ручном режиме
- Переключатель АВТО/РУЧН: меняет цвет
- Строка статуса: всегда видна

Управление уставками:
Вкл: [3.5] бар   Выкл: [5.0] бар
Авария: <2.0 >6.5 бар

Таймеры защиты:
Пуск: [2]с   Мин.работа: [10]с   Мин.пауза: [30]с

Диагностика:
Давление: OK   Тепловая: OK
Режим: АВТО   Команда: ВКЛ


Итог:
1. 3 экрана: Мониторинг → Управление → Диагностика
2. Цвета: зелёный=норма, жёлтый=внимание, красный=авария
3. Большие кнопки для ПУСК/СТОП
4. Уставки меняются слайдерами или вводом
5. История аварий с временными метками
6. Подтверждение критичных действий


Безопасность:
- Переключение АВТО/РУЧН требует подтверждения
- Изменение уставок - кнопка СОХРАНИТЬ
- Аварии требуют ручного сброса
- Кнопки только когда разрешено логикой
- Добавление пользователя оператор и администратор

Передача значений:

Передача значений предполагается с нижнего уровня в систему верхнего уровня посредством OPC UA: данные из контроллера публикуются как теги (узлы адресного пространства OPC UA), которые затем подписываются или опрашиваются SCADA-системой для отображения и обработки

## **3.Диагностика Modbus связи (RS-485)** 

**Физический уровень**
- Кабель A/B: целостность, полярность
- Проверить стабильность питания устройства

**Настройки ПЛК**
- Скорость (9600, 19200...)
- Формат (8N1, 8E1...)
- Адрес устройства (1-247)
- Таймаут

**Инструменты**
- USB-RS485 адаптер
- Имитатор Modbus Slave:
  
  Если работает с имитатором, то проблема в устройстве

  Не работает → Проблема в ПЛК/кабеле
  

**Типовые ошибки**
- Timeout: неверные настройки/адрес, мало таймаута
- CRC Error: помехи, неверный формат порта
- Illegal Function: устройство не поддерживает команду
- Illegal Address: неправильный номер регистра

## **4.Треугольник** 

```
def find_third_point(A, B):
    x1, y1 = A
    x2, y2 = B

    dx = x2 - x1
    dy = y2 - y1


    candidates = [
        (x1 - dy, y1 + dx),  # поворот вокруг A
        (x1 + dy, y1 - dx),
        (x2 - dy, y2 + dx),  # поворот вокруг B
        (x2 + dy, y2 - dx)
    ]

    # Оставляем только те, где x >= 0 и y >= 0
    result = []
    for x, y in candidates:
        if x >= 0 and y >= 0:
            if (x, y) != A and (x, y) != B:  # избегаем совпадений
                result.append((x, y))
    
    return list(set(result))
    ```
